# Deployment Guide for Render

This guide will help you deploy the Assessment Application to Render.

## Prerequisites

1. **GitHub Account**: Your code should be in a GitHub repository
2. **Render Account**: Sign up at [render.com](https://render.com)
3. **Admin Email**: You'll need to know which email addresses should have admin access

## Deployment Steps

### Method 1: Using render.yaml (Recommended)

1. **Push your code to GitHub** including all the deployment files:
   - `requirements.txt`
   - `build.sh`
   - `render.yaml`
   - `runtime.txt`
   - Updated `settings.py`

2. **Connect to Render**:
   - Go to [render.com](https://render.com) and sign in
   - Click "New +" → "Blueprint"
   - Connect your GitHub repository
   - Select the repository containing your assessment app

3. **Configure Environment Variables**:
   The `render.yaml` file will automatically set up most variables, but you may need to customize:
   - `ALLOWED_HOSTS`: Replace with your actual domain (e.g., `your-app-name.onrender.com`)
   - `SECRET_KEY`: Will be auto-generated
   - `DEBUG`: Set to `False` for production

4. **Deploy**:
   - Click "Create New Blueprint"
   - Render will automatically create both the web service and PostgreSQL database
   - Wait for the build to complete (5-10 minutes)

### Method 2: Manual Setup

1. **Create Web Service**:
   - Go to Render Dashboard
   - Click "New +" → "Web Service"
   - Connect your GitHub repository
   - Configure:
     - **Build Command**: `./build.sh`
     - **Start Command**: `gunicorn assessment_web.wsgi:application`
     - **Environment**: `Python 3`

2. **Create Database**:
   - Click "New +" → "PostgreSQL"
   - Choose the free plan
   - Note the database connection details

3. **Set Environment Variables**:
   ```
   SECRET_KEY=your-secret-key-here
   DEBUG=False
   ALLOWED_HOSTS=your-app-name.onrender.com
   DATABASE_URL=postgresql://... (from database service)
   ```

## Post-Deployment Setup

### 1. Create Admin User

After successful deployment, you'll need to create an admin user:

1. Go to your Render dashboard
2. Open your web service
3. Click on "Shell" tab
4. Run the following commands:

```bash
python manage.py createsuperuser
```

Follow the prompts to create your admin account.

### 2. Update CSRF Trusted Origins

In your `settings.py`, update the CSRF trusted origins with your actual domain:

```python
CSRF_TRUSTED_ORIGINS = [
    'https://*.onrender.com',
    'https://your-actual-app-name.onrender.com',  # Replace with your real domain
]
```

### 3. Configure Admin Access

The application uses email-based admin access. Make sure to:

1. Update the `ADMIN_EMAILS` list in your code if needed
2. Users with these emails will automatically get admin access when they log in

## Environment Variables Reference

| Variable | Description | Example |
|----------|-------------|---------|
| `SECRET_KEY` | Django secret key | Auto-generated by Render |
| `DEBUG` | Debug mode | `False` |
| `ALLOWED_HOSTS` | Allowed hostnames | `your-app.onrender.com` |
| `DATABASE_URL` | PostgreSQL connection | Auto-set by Render |

## Troubleshooting

### Common Issues

1. **Build Fails**:
   - Check that `build.sh` is executable
   - Verify all dependencies are in `requirements.txt`
   - Check build logs for specific errors

2. **Static Files Not Loading**:
   - Ensure WhiteNoise is properly configured
   - Check that `collectstatic` runs during build

3. **Database Connection Issues**:
   - Verify `DATABASE_URL` is set correctly
   - Check PostgreSQL service is running
   - Ensure migrations ran successfully

4. **Admin Access Issues**:
   - Verify admin emails are configured correctly
   - Check that users are logging in with the correct email format

### Useful Commands

Access your app's shell on Render:
```bash
# Check database status
python manage.py dbshell

# Run migrations manually
python manage.py migrate

# Create superuser
python manage.py createsuperuser

# Collect static files
python manage.py collectstatic

# Check logs
python manage.py check --deploy
```

## Security Considerations

1. **HTTPS**: Render automatically provides HTTPS
2. **Environment Variables**: Never commit sensitive data to Git
3. **Database**: Use the managed PostgreSQL service
4. **Static Files**: Served via WhiteNoise with compression
5. **Admin Access**: Restricted to authorized email addresses

## Scaling

- **Free Tier**: Suitable for development and small deployments
- **Paid Tiers**: Available for production use with guaranteed uptime
- **Database**: Free PostgreSQL has limitations; upgrade for production

## Monitoring

- **Render Dashboard**: Monitor service health and logs
- **Django Admin**: Use `/admin/` for application management
- **Logs**: Available in Render dashboard under "Logs" tab

## Custom Domain (Optional)

To use a custom domain:
1. Go to your service settings in Render
2. Add your custom domain
3. Update DNS records as instructed
4. Update `ALLOWED_HOSTS` and `CSRF_TRUSTED_ORIGINS`

## Support

- **Render Documentation**: [render.com/docs](https://render.com/docs)
- **Django Documentation**: [docs.djangoproject.com](https://docs.djangoproject.com)
- **Application Issues**: Check the GitHub repository for issues and documentation 